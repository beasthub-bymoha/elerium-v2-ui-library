
if not getgenv().config then
    warn("Config not found. Load config.lua first.")
    return
end

local cfg = getgenv().config

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera



local gui = Instance.new("ScreenGui")
gui.Name = "SCP_HUB"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local bg = Instance.new("Frame")
bg.Parent = gui
bg.Size = UDim2.fromScale(1, 1)
bg.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
bg.BackgroundTransparency = 0.25
bg.BorderSizePixel = 0

-- TITLE
local title = Instance.new("TextLabel")
title.Parent = bg
title.Size = UDim2.new(1, 0, 0, 90)
title.Position = UDim2.new(0, 0, 0, 25)
title.BackgroundTransparency = 1
title.Text = "SCP HUB  -  AUTO BOUNTY HUNT"
title.TextColor3 = Color3.fromRGB(255, 50, 50)
title.TextScaled = true
title.Font = Enum.Font.GothamBlack

-- TARGET
local targetLabel = Instance.new("TextLabel")
targetLabel.Parent = bg
targetLabel.Size = UDim2.new(1, 0, 0, 70)
targetLabel.Position = UDim2.new(0, 0, 0.30, 0)
targetLabel.BackgroundTransparency = 1
targetLabel.Text = "TARGET : NONE"
targetLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
targetLabel.TextScaled = true
targetLabel.Font = Enum.Font.GothamBold

-- BOUNTY
local bountyLabel = Instance.new("TextLabel")
bountyLabel.Parent = bg
bountyLabel.Size = UDim2.new(1, 0, 0, 70)
bountyLabel.Position = UDim2.new(0, 0, 0.40, 0)
bountyLabel.BackgroundTransparency = 1
bountyLabel.Text = "CURRENT BOUNTY : 0"
bountyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
bountyLabel.TextScaled = true
bountyLabel.Font = Enum.Font.GothamBold



getgenv().SCP_UI = {
    SetTarget = function(name)
        targetLabel.Text = "TARGET : " .. tostring(name)
    end,

    SetBounty = function(amount)
        bountyLabel.Text = "CURRENT BOUNTY : " .. tostring(amount)
    end
}



local ESP = {}

local function createESP(player)
    if player == LocalPlayer then return end

    local box = Drawing.new("Square")
    box.Color = cfg.ESP.Color
    box.Thickness = 2
    box.Filled = false
    box.Visible = false

    local name = Drawing.new("Text")
    name.Color = cfg.ESP.Color
    name.Size = 16
    name.Center = true
    name.Outline = true
    name.Visible = false

    ESP[player] = {
        Box = box,
        Name = name
    }
end

local function removeESP(player)
    if ESP[player] then
        for _, obj in pairs(ESP[player]) do
            obj:Remove()
        end
        ESP[player] = nil
    end
end

-- INIT EXISTING PLAYERS
for _, p in ipairs(Players:GetPlayers()) do
    createESP(p)
end

Players.PlayerAdded:Connect(createESP)
Players.PlayerRemoving:Connect(removeESP)

-- ESP UPDATE LOOP
RunService.RenderStepped:Connect(function()
    if not cfg.ESP.Enable then return end

    for player, esp in pairs(ESP) do
        local char = player.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        local hum = char and char:FindFirstChild("Humanoid")

        if hrp and hum and hum.Health > 0 then
            local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
            local dist = (Camera.CFrame.Position - hrp.Position).Magnitude

            if onScreen and dist <= cfg.ESP.MaxDistance then
                local size = math.clamp(3000 / dist, 20, 200)

                esp.Box.Size = Vector2.new(size, size * 1.5)
                esp.Box.Position = Vector2.new(pos.X - size / 2, pos.Y - size)
                esp.Box.Visible = cfg.ESP.ShowBox

                esp.Name.Text = player.Name
                esp.Name.Position = Vector2.new(pos.X, pos.Y - size - 15)
                esp.Name.Visible = cfg.ESP.ShowName
            else
                esp.Box.Visible = false
                esp.Name.Visible = false
            end
        else
            esp.Box.Visible = false
            esp.Name.Visible = false
        end
    end
end)
